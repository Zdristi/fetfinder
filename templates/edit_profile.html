{% extends "base.html" %}

{% block title %}{{ get_text('complete_profile') }} - {{ SITE_NAME }}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">{{ get_text('complete_profile') }}</h2>
        <p style="color: var(--warning); font-size: 0.9em; margin-top: 10px;">
            <i class="fas fa-exclamation-circle"></i> 
            {{ get_text('required_fields_note') or 'Fields marked with * are required to complete registration' }}
        </p>
    </div>
    
    <form method="POST" enctype="multipart/form-data" id="profileForm">
        <div class="form-group">
            <label for="bio" class="form-label">{{ get_text('bio') }} *</label>
            <textarea id="bio" name="bio" class="form-control" placeholder="{{ get_text('bio') }}" required>{{ user.bio or '' }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="country" class="form-label">{{ get_text('country') }} *</label>
            <select id="country" name="country" class="form-control" required>
                    <option value="">{{ get_text('select_country') }}</option>
                    {% for country in countries %}
                        <option value="{{ country }}" {% if user.country == country %}selected{% endif %}>{{ country }}</option>
                    {% endfor %}
                </select>
        </div>
        
        <div class="form-group">
            <label for="city" class="form-label">{{ get_text('city') }} *</label>
            <select id="city" name="city" class="form-control" {% if not user.country %}disabled{% endif %} required>
                <option value="">{{ get_text('select_city') }}</option>
                {% if user.country %}
                    {% for city in COUNTRIES_CITIES.get(user.country, []) %}
                        <option value="{{ city }}" {% if user.city == city %}selected{% endif %}>{{ city }}</option>
                    {% endfor %}
                {% endif %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="photo" class="form-label">{{ get_text('photo') }} *</label>
            <div class="file-input-wrapper">
                <input type="file" id="photo" name="photo" class="file-input" accept="image/*" style="display: none;" required>
                <button type="button" class="btn btn-outline" onclick="document.getElementById('photo').click();">
                    <i class="fas fa-upload"></i> {{ get_text('choose_file') or 'Choose File' }}
                </button>
                <span id="photo-file-name" class="file-name-display">{{ get_text('no_file_chosen') or 'No file chosen' }}</span>
            </div>
            {% if user.photo %}
                <div style="margin-top: 10px;">
                    <img src="{{ url_for('static', filename='uploads/' + user.photo) if user.photo and not user.photo.startswith('http') else user.photo }}" 
                         alt="Current photo" style="max-width: 100px; max-height: 100px; border-radius: 10px;">
                </div>
            {% endif %}
        </div>
        
                <!-- Extended Profile Fields -->
        <div class="extended-profile-section">
            <h3 class="section-title-text">
                <i class="fas fa-user-circle"></i> {{ get_text('extended_profile') or 'Extended Profile' }}
            </h3>
            
            <div class="profile-fields-grid">
                <div class="form-group">
                    <label for="about_me_video" class="form-label">{{ get_text('about_me_video') }}</label>
                    <input type="url" id="about_me_video" name="about_me_video" class="form-control" 
                           value="{{ user.about_me_video or '' }}" 
                           placeholder="{{ get_text('about_me_video') }} (YouTube, Vimeo, etc.)">
                </div>
                
                <div class="form-group">
                    <label for="relationship_goals" class="form-label">{{ get_text('relationship_goals') }}</label>
                    <select id="relationship_goals" name="relationship_goals" class="form-control">
                        <option value="">{{ get_text('select_option') or 'Select option' }}</option>
                        <option value="Long-term relationship" {% if user.relationship_goals == 'Long-term relationship' %}selected{% endif %}>{{ get_text('long_term_relationship') or 'Long-term relationship' }}</option>
                        <option value="Short-term fun" {% if user.relationship_goals == 'Short-term fun' %}selected{% endif %}>{{ get_text('short_term_fun') or 'Short-term fun' }}</option>
                        <option value="Marriage" {% if user.relationship_goals == 'Marriage' %}selected{% endif %}>{{ get_text('marriage') or 'Marriage' }}</option>
                        <option value="Friends" {% if user.relationship_goals == 'Friends' %}selected{% endif %}>{{ get_text('friends') or 'Friends' }}</option>
                        <option value="Open relationship" {% if user.relationship_goals == 'Open relationship' %}selected{% endif %}>{{ get_text('open_relationship') or 'Open relationship' }}</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="lifestyle" class="form-label">{{ get_text('lifestyle') }}</label>
                    <select id="lifestyle" name="lifestyle" class="form-control">
                        <option value="">{{ get_text('select_option') or 'Select option' }}</option>
                        <option value="Active" {% if user.lifestyle == 'Active' %}selected{% endif %}>{{ get_text('active') or 'Active' }}</option>
                        <option value="Sedentary" {% if user.lifestyle == 'Sedentary' %}selected{% endif %}>{{ get_text('sedentary') or 'Sedentary' }}</option>
                        <option value="Moderate" {% if user.lifestyle == 'Moderate' %}selected{% endif %}>{{ get_text('moderate') or 'Moderate' }}</option>
                        <option value="Very Active" {% if user.lifestyle == 'Very Active' %}selected{% endif %}>{{ get_text('very_active') or 'Very Active' }}</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="diet" class="form-label">{{ get_text('diet') }}</label>
                    <select id="diet" name="diet" class="form-control">
                        <option value="">{{ get_text('select_option') or 'Select option' }}</option>
                        <option value="Vegetarian" {% if user.diet == 'Vegetarian' %}selected{% endif %}>{{ get_text('vegetarian') or 'Vegetarian' }}</option>
                        <option value="Vegan" {% if user.diet == 'Vegan' %}selected{% endif %}>{{ get_text('vegan') or 'Vegan' }}</option>
                        <option value="Omnivore" {% if user.diet == 'Omnivore' %}selected{% endif %}>{{ get_text('omnivore') or 'Omnivore' }}</option>
                        <option value="Pescatarian" {% if user.diet == 'Pescatarian' %}selected{% endif %}>{{ get_text('pescatarian') or 'Pescatarian' }}</option>
                        <option value="Keto" {% if user.diet == 'Keto' %}selected{% endif %}>{{ get_text('keto') or 'Keto' }}</option>
                        <option value="Paleo" {% if user.diet == 'Paleo' %}selected{% endif %}>{{ get_text('paleo') or 'Paleo' }}</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="smoking" class="form-label">{{ get_text('smoking') }}</label>
                    <select id="smoking" name="smoking" class="form-control">
                        <option value="">{{ get_text('select_option') or 'Select option' }}</option>
                        <option value="Never" {% if user.smoking == 'Never' %}selected{% endif %}>{{ get_text('never') or 'Never' }}</option>
                        <option value="Occasionally" {% if user.smoking == 'Occasionally' %}selected{% endif %}>{{ get_text('occasionally') or 'Occasionally' }}</option>
                        <option value="Socially" {% if user.smoking == 'Socially' %}selected{% endif %}>{{ get_text('socially') or 'Socially' }}</option>
                        <option value="Regularly" {% if user.smoking == 'Regularly' %}selected{% endif %}>{{ get_text('regularly') or 'Regularly' }}</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="drinking" class="form-label">{{ get_text('drinking') }}</label>
                    <select id="drinking" name="drinking" class="form-control">
                        <option value="">{{ get_text('select_option') or 'Select option' }}</option>
                        <option value="Never" {% if user.drinking == 'Never' %}selected{% endif %}>{{ get_text('never') or 'Never' }}</option>
                        <option value="Occasionally" {% if user.drinking == 'Occasionally' %}selected{% endif %}>{{ get_text('occasionally') or 'Occasionally' }}</option>
                        <option value="Socially" {% if user.drinking == 'Socially' %}selected{% endif %}{{ get_text('socially') or 'Socially' }}</option>
                        <option value="Regularly" {% if user.drinking == 'Regularly' %}selected{% endif %}{{ get_text('regularly') or 'Regularly' }}</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="occupation" class="form-label">{{ get_text('occupation') }}</label>
                    <input type="text" id="occupation" name="occupation" class="form-control" 
                           value="{{ user.occupation or '' }}" 
                           placeholder="{{ get_text('occupation') }}">
                </div>
                
                <div class="form-group">
                    <label for="education" class="form-label">{{ get_text('education') }}</label>
                    <input type="text" id="education" name="education" class="form-control" 
                           value="{{ user.education or '' }}" 
                           placeholder="{{ get_text('education') }}">
                </div>
                
                <div class="form-group">
                    <label for="children" class="form-label">{{ get_text('children') }}</label>
                    <select id="children" name="children" class="form-control">
                        <option value="">{{ get_text('select_option') or 'Select option' }}</option>
                        <option value="None" {% if user.children == 'None' %}selected{% endif %}>{{ get_text('none') or 'None' }}</option>
                        <option value="Yes" {% if user.children == 'Yes' %}selected{% endif %}>{{ get_text('yes') or 'Yes' }}</option>
                        <option value="Want someday" {% if user.children == 'Want someday' %}selected{% endif %}>{{ get_text('want_someday') or 'Want someday' }}</option>
                        <option value="Don't want" {% if user.children == "Don't want" %}selected{% endif %}{{ get_text('dont_want') }}</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="pets" class="form-label">{{ get_text('pets') }}</label>
                    <input type="text" id="pets" name="pets" class="form-control" 
                           value="{{ user.pets or '' }}" 
                           placeholder="{{ get_text('pets') }} ({{ get_text('comma_separated') or 'comma separated' }})">
                </div>
            </div>
        </div>
        
        <!-- Location Matching Settings -->
        <div style="margin: 30px 0; padding: 20px; border: 2px solid var(--accent); border-radius: 15px; background: var(--card-bg);">
            <h3 style="color: var(--accent); margin-top: 0;">
                <i class="fas fa-map-marker-alt"></i> {{ get_text('location_matching_settings') or 'Location Matching Settings' }}
            </h3>
            
            <div class="form-group" style="margin-top: 15px;">
                <label class="checkbox-container">
                    <input type="checkbox" name="match_by_city" value="1" 
                           {% if user.match_by_city %}checked{% endif %}>
                    <span class="checkmark"></span>
                    {{ get_text('match_by_city') or 'Match only with users from my city' }}
                </label>
            </div>
            
            <div class="form-group" style="margin-top: 10px;">
                <label class="checkbox-container">
                    <input type="checkbox" name="match_by_country" value="1" 
                           {% if user.match_by_country %}checked{% endif %}>
                    <span class="checkmark"></span>
                    {{ get_text('match_by_country') or 'Match only with users from my country' }}
                </label>
            </div>
            
            <div class="form-group" style="margin-top: 15px; color: var(--gray); font-size: 0.9rem;">
                <small>{{ get_text('location_matching_note') or 'Note: These settings control which users appear in your swipe feed. If both are checked, city takes priority.' }}</small>
            </div>
        </div>
        
        <!-- Additional Photos Section -->
        <div style=\"margin: 30px 0; padding: 20px; border: 2px solid var(--primary); border-radius: 15px; background: var(--card-bg);\">
            <h3 style=\"color: var(--primary); margin-top: 0;\">
                <i class=\"fas fa-images\"></i> {{ get_text('additional_photos') }}
            </h3>
            
            <div class=\"form-group\">
                <label for=\"additional_photos\" class=\"form-label\">{{ get_text('upload_photos') }}</label>
                <div class=\"file-input-wrapper\">
                    <input type=\"file\" id=\"additional_photos\" name=\"additional_photos\" class=\"file-input\" 
                           accept=\"image/*\" multiple style=\"display: none;\">
                    <button type=\"button\" class=\"btn btn-outline\" onclick=\"document.getElementById('additional_photos').click();\">
                        <i class=\"fas fa-upload\"></i> {{ get_text('choose_files') or 'Choose Files' }}
                    </button>
                    <span id=\"additional-photos-file-name\" class=\"file-name-display\">{{ get_text('no_files_chosen') or 'No files chosen' }}</span>
                </div>
                <small style=\"color: var(--gray);\">{{ get_text('ctrl_click_multiple') or 'Ctrl+Click to select multiple files' }}</small>
            </div>
            
            {% if user.user_photos and user.user_photos|length > 0 %}\n            <div style=\"margin-top: 20px;\">\n                <h4>{{ get_text('current_photos') or 'Current Photos' }}</h4>\n                <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;\">\n                    {% for photo in user.user_photos %}
                    <div style=\"position: relative; border: 2px solid {% if photo.is_primary %}var(--primary){% else %}var(--border-color){% endif %}; border-radius: 10px; overflow: hidden;\">
                        <img src=\"{{ url_for('static', filename='uploads/' + photo.photo_path) }}\" 
                             alt=\"User photo\" 
                             style=\"width: 100%; height: 150px; object-fit: cover;\">
                        {% if photo.is_premium %}
                        <div style=\"position: absolute; top: 5px; right: 5px; background: var(--accent); color: white; padding: 2px 5px; border-radius: 3px; font-size: 0.7rem;\">
                            {{ get_text('premium') or 'Premium' }}
                        </div>
                        {% endif %}
                        <div class=\"photo-actions-container\">
                            {% if photo.is_primary %}

                            <div class=\"photo-primary-badge\">
                                <i class=\"fas fa-star\"></i>
                                <span>{{ get_text('primary') }}</span>
                            </div>
                            {% else %}
                            <button type="button" class="photo-action-btn btn-set-primary" 
                                    onclick="setPrimaryPhoto({{ photo.id }})">
                                <i class="fas fa-star"></i>
                                {{ get_text('set_primary_photo') }}
                            </button>
                            {% endif %}
                            <button type="button" class="photo-action-btn btn-delete" 
                                    onclick="deletePhoto({{ photo.id }})">
                                <i class="fas fa-trash"></i>
                                {{ get_text('delete') }}
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        
        <div style=\"margin: 30px 0; padding: 20px; border: 2px solid var(--primary); border-radius: 15px;\">
            <h3 style="color: var(--primary); margin-top: 0;">
                <i class="fas fa-fire"></i> {{ get_text('fetishes') }}
            </h3>
            <p style="color: var(--gray);">{{ get_text('add_fetish') }}:</p>
            
            <div class="checkbox-grid" id="fetishes-grid">
                {% for fetish in fetishes %}
                    <div class="fetish-item">
                        <input type="checkbox" id="fetish_{{ loop.index }}" name="fetishes" value="{{ fetish }}" 
                               {% if fetish in user.fetishes %}checked{% endif %}>
                        <label for="fetish_{{ loop.index }}" class="fetish-btn">{{ fetish }}</label>
                    </div>
                {% endfor %}
            </div>
            
            <div class="form-group" style="margin-top: 20px;">
                <label for="custom_fetish" class="form-label">{{ get_text('add_fetish') }}:</label>
                <input type="text" id="custom_fetish" name="custom_fetish" class="form-control" placeholder="{{ get_text('add_fetish') }}...">
            </div>
        </div>
        
        <div style="margin: 30px 0; padding: 20px; border: 2px solid var(--accent); border-radius: 15px;">
            <h3 style="color: var(--accent); margin-top: 0;">
                <i class="fas fa-heart"></i> {{ get_text('interests') }}
            </h3>
            <p style="color: var(--gray);">{{ get_text('add_interest') }}:</p>
            
            <div class="checkbox-grid" id="interests-grid">
                {% for interest in interests %}
                    <div class="interest-item">
                        <input type="checkbox" id="interest_{{ loop.index }}" name="interests" value="{{ interest }}" 
                               {% if interest in user.interests %}checked{% endif %}>
                        <label for="interest_{{ loop.index }}" class="interest-btn">{{ interest }}</label>
                    </div>
                {% endfor %}
            </div>
            
            <div class="form-group" style="margin-top: 20px;">
                <label for="custom_interest" class="form-label">{{ get_text('add_interest') }}:</label>
                <input type="text" id="custom_interest" name="custom_interest" class="form-control" placeholder="{{ get_text('add_interest') }}...">
            </div>
        </div>
        
        <button type="submit" class="btn" style="width: 100%; padding: 15px; font-size: 1.1rem;">
            <i class="fas fa-save"></i> {{ get_text('update_profile') }}
        </button>
    </form>
</div>

<script>
    document.getElementById('country').addEventListener('change', function() {
        const country = this.value;
        const citySelect = document.getElementById('city');
        
        if (country) {
            // Fetch cities for the selected country
            fetch(`/get_cities/${country}`)
                .then(response => response.json())
                .then(cities => {
                    citySelect.innerHTML = '<option value="">{{ get_text("select_city") }}</option>';
                    cities.forEach(city => {
                        const option = document.createElement('option');
                        option.value = city;
                        option.textContent = city;
                        citySelect.appendChild(option);
                    });
                    citySelect.disabled = false;
                });
        } else {
            citySelect.innerHTML = '<option value="">{{ get_text("select_city") }}</option>';
            citySelect.disabled = true;
        }
    });
    
    // Add event listeners to update button styles when checkboxes are checked
    document.querySelectorAll('input[name="fetishes"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const label = document.querySelector(`label[for="${this.id}"]`);
            label.classList.toggle('selected', this.checked);
        });
    });
    
    document.querySelectorAll('input[name="interests"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const label = document.querySelector(`label[for="${this.id}"]`);
            label.classList.toggle('selected', this.checked);
        });
    });
</script>

<style>
    .fetish-btn, .interest-btn {
        display: block;
        padding: 10px 15px;
        margin: 5px;
        background-color: var(--card-bg);
        color: var(--text-color);
        border: 2px solid var(--border-color);
        border-radius: 20px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s ease;
        font-size: 0.9rem;
    }
    
    .fetish-btn:hover, .interest-btn:hover {
        background-color: var(--bg-color);
        border-color: var(--primary);
    }
    
    .fetish-btn.selected, .interest-btn.selected {
        background-color: var(--primary);
        color: white;
        border-color: var(--primary);
    }
    
    [data-theme="dark"] .fetish-btn.selected, [data-theme="dark"] .interest-btn.selected {
        background-color: var(--primary);
        color: white;
        border-color: var(--primary);
    }
    
    .fetish-item, .interest-item {
        display: block;
        margin: 0;
    }
    
    .fetish-item input[type="checkbox"], .interest-item input[type="checkbox"] {
        display: none;
    }
    
    [data-theme="dark"] .card-title {
        color: white !important;
    }
    
    .file-input-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .file-name-display {
        font-size: 0.9rem;
        color: var(--gray);
        max-width: 100%;
        word-break: break-word;
    }
    
    [data-theme="dark"] .file-name-display {
        color: var(--gray);
    }
    
    /* Extended profile section styles for dark theme */
    [data-theme="dark"] .extended-profile-section {
        border: 2px solid var(--accent);
        background: var(--card-bg);
    }
    
    [data-theme="dark"] .extended-profile-section h3 {
        color: var(--accent);
    }
    
    /* Form group enhancements for extended profile */
    .extended-profile-section .form-group {
        margin-bottom: 20px;
    }
    
    .extended-profile-section label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--text-color);
    }
    
    .extended-profile-section .form-control {
        width: 100%;
        padding: 10px 15px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        background: var(--card-bg);
        color: var(--text-color);
        font-size: 1rem;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    
    .extended-profile-section .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
    }
    
    [data-theme="dark"] .extended-profile-section .form-control {
        background: var(--card-bg);
        border-color: var(--border-color);
        color: var(--text-color);
    }
    
    /* Photo action buttons styles */
    .photo-action-btn {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 6px 12px;
        font-size: 0.8rem;
        font-weight: 500;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        margin: 2px;
    }
    
    .photo-action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .photo-action-btn:active {
        transform: translateY(0);
    }
    
    .btn-set-primary {
        background: linear-gradient(135deg, var(--accent), var(--primary));
        color: white;
    }
    
    .btn-delete {
        background: linear-gradient(135deg, var(--danger), #c82333);
        color: white;
    }
    
    .photo-primary-badge {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 6px 12px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    .photo-actions-container {
        padding: 10px;
        background: rgba(0,0,0,0.8);
        color: white;
        font-size: 0.85rem;
        text-align: center;
        border-radius: 0 0 10px 10px;
    }
    
    .extended-profile-section {
        margin: 30px 0;
        padding: 20px;
        border: 2px solid var(--accent);
        border-radius: 15px;
        background: var(--card-bg);
    }
    
    .extended-profile-section h3 {
        color: var(--accent);
        margin-top: 0;
    }
    
    .profile-fields-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    /* Checkbox container for location matching settings */
    .checkbox-container {
        display: block;
        position: relative;
        padding-left: 35px;
        margin-bottom: 12px;
        cursor: pointer;
        font-size: 1rem;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        color: var(--text-color);
    }
    
    .checkbox-container input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
    }
    
    .checkmark {
        position: absolute;
        top: 0;
        left: 0;
        height: 25px;
        width: 25px;
        background-color: var(--card-bg);
        border: 2px solid var(--border-color);
        border-radius: 4px;
        transition: all 0.3s ease;
    }
    
    .checkbox-container:hover .checkmark {
        background-color: var(--bg-color);
        border-color: var(--primary);
    }
    
    .checkbox-container input:checked ~ .checkmark {
        background-color: var(--primary);
        border-color: var(--primary);
    }
    
    .checkmark:after {
        content: "";
        position: absolute;
        display: none;
    }
    
    .checkbox-container input:checked ~ .checkmark:after {
        display: block;
    }
    
    .checkbox-container .checkmark:after {
        left: 9px;
        top: 5px;
        width: 5px;
        height: 10px;
        border: solid white;
        border-width: 0 3px 3px 0;
        -webkit-transform: rotate(45deg);
        -ms-transform: rotate(45deg);
        transform: rotate(45deg);
    }
</style>

<script>
    document.getElementById('country').addEventListener('change', function() {
        const country = this.value;
        const citySelect = document.getElementById('city');
        
        if (country) {
            // Fetch cities for the selected country
            fetch(`/get_cities/${country}`)
                .then(response => response.json())
                .then(cities => {
                    citySelect.innerHTML = '<option value="">{{ get_text("select_city") }}</option>';
                    cities.forEach(city => {
                        const option = document.createElement('option');
                        option.value = city;
                        option.textContent = city;
                        citySelect.appendChild(option);
                    });
                    citySelect.disabled = false;
                });
        } else {
            citySelect.innerHTML = '<option value="">{{ get_text("select_city") }}</option>';
            citySelect.disabled = true;
        }
    });
    
    // Photo management functions
    function setPrimaryPhoto(photoId) {
        fetch(`/api/photo/${photoId}/set_primary`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if(data.status === 'success') {
                alert('{{ get_text("primary_photo_set") or "Primary photo set successfully" }}');
                location.reload();
            } else {
                alert('{{ get_text("error_setting_primary_photo") or "Error setting primary photo" }}');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('{{ get_text("error_setting_primary_photo") or "Error setting primary photo" }}');
        });
    }
    
    function deletePhoto(photoId) {
        if(confirm('{{ get_text("confirm_delete_photo") or "Are you sure you want to delete this photo?" }}')) {
            fetch(`/api/photo/${photoId}/delete`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if(data.status === 'success') {
                    alert('{{ get_text("photo_deleted") or "Photo deleted successfully" }}');
                    location.reload();
                } else {
                    alert('{{ get_text("error_deleting_photo") or "Error deleting photo" }}');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('{{ get_text("error_deleting_photo") or "Error deleting photo" }}');
            });
        }
    }
    
    // Update file name display when a file is selected
    document.getElementById('photo').addEventListener('change', function() {
        const fileNameSpan = document.getElementById('photo-file-name');
        if (this.files && this.files[0]) {
            fileNameSpan.textContent = this.files[0].name;
        } else {
            fileNameSpan.textContent = '{{ get_text("no_file_chosen") or "No file chosen" }}';
        }
    });
    
    document.getElementById('additional_photos').addEventListener('change', function() {
        const fileNameSpan = document.getElementById('additional-photos-file-name');
        if (this.files && this.files.length > 0) {
            if (this.files.length === 1) {
                fileNameSpan.textContent = this.files[0].name;
            } else {
                fileNameSpan.textContent = this.files.length + ' files selected';
            }
        } else {
            fileNameSpan.textContent = '{{ get_text("no_files_chosen") or "No files chosen" }}';
        }
    });
</script>

{% endblock %}
