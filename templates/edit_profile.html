{% extends "base.html" %}

{% block title %}{{ get_text('complete_profile') }} - LoveConnect{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">{{ get_text('complete_profile') }}</h2>
    </div>
    
    <form method="POST" enctype="multipart/form-data" id="profileForm">
        <div class="form-group">
            <label for="bio" class="form-label">{{ get_text('bio') }}</label>
            <textarea id="bio" name="bio" class="form-control" placeholder="{{ get_text('bio') }}">{{ user.bio or '' }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="country" class="form-label">{{ get_text('country') }}</label>
            <select id="country" name="country" class="form-control">
                    <option value="">{{ get_text('select_country') }}</option>
                    {% for country in countries %}
                        <option value="{{ country }}" {% if user.country == country %}selected{% endif %}>{{ country }}</option>
                    {% endfor %}
                </select>
        </div>
        
        <div class="form-group">
            <label for="city" class="form-label">{{ get_text('city') }}</label>
            <select id="city" name="city" class="form-control" {% if not user.country %}disabled{% endif %}>
                <option value="">{{ get_text('select_city') }}</option>
                {% if user.country %}
                    {% for city in COUNTRIES_CITIES.get(user.country, []) %}
                        <option value="{{ city }}" {% if user.city == city %}selected{% endif %}>{{ city }}</option>
                    {% endfor %}
                {% endif %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="photo" class="form-label">{{ get_text('photo') }}</label>
            <input type="file" id="photo" name="photo" class="form-control" accept="image/*">
            {% if user.photo %}
                <div style="margin-top: 10px;">
                    <img src="{{ url_for('static', filename='uploads/' + user.photo) if user.photo and not user.photo.startswith('http') else user.photo }}" 
                         alt="Current photo" style="max-width: 100px; max-height: 100px; border-radius: 10px;">
                </div>
            {% endif %}
        </div>
        
        <div style="margin: 30px 0; padding: 20px; border: 2px solid var(--primary); border-radius: 15px;">
            <h3 style="color: var(--primary); margin-top: 0;">
                <i class="fas fa-fire"></i> {{ get_text('fetishes') }}
            </h3>
            <p style="color: var(--gray);">{{ get_text('add_fetish') }}:</p>
            
            <div class="checkbox-grid" id="fetishes-grid">
                {% for fetish in fetishes %}
                    <div class="fetish-item">
                        <input type="checkbox" id="fetish_{{ loop.index }}" name="fetishes" value="{{ fetish }}" 
                               {% if fetish in user.fetishes %}checked{% endif %}>
                        <label for="fetish_{{ loop.index }}" class="fetish-btn">{{ fetish }}</label>
                    </div>
                {% endfor %}
            </div>
            
            <div class="form-group" style="margin-top: 20px;">
                <label for="custom_fetish" class="form-label">{{ get_text('add_fetish') }}:</label>
                <input type="text" id="custom_fetish" name="custom_fetish" class="form-control" placeholder="{{ get_text('add_fetish') }}...">
            </div>
        </div>
        
        <div style="margin: 30px 0; padding: 20px; border: 2px solid var(--accent); border-radius: 15px;">
            <h3 style="color: var(--accent); margin-top: 0;">
                <i class="fas fa-heart"></i> {{ get_text('interests') }}
            </h3>
            <p style="color: var(--gray);">{{ get_text('add_interest') }}:</p>
            
            <div class="checkbox-grid" id="interests-grid">
                {% for interest in interests %}
                    <div class="interest-item">
                        <input type="checkbox" id="interest_{{ loop.index }}" name="interests" value="{{ interest }}" 
                               {% if interest in user.interests %}checked{% endif %}>
                        <label for="interest_{{ loop.index }}" class="interest-btn">{{ interest }}</label>
                    </div>
                {% endfor %}
            </div>
            
            <div class="form-group" style="margin-top: 20px;">
                <label for="custom_interest" class="form-label">{{ get_text('add_interest') }}:</label>
                <input type="text" id="custom_interest" name="custom_interest" class="form-control" placeholder="{{ get_text('add_interest') }}...">
            </div>
        </div>
        
        <button type="submit" class="btn" style="width: 100%; padding: 15px; font-size: 1.1rem;">
            <i class="fas fa-save"></i> {{ get_text('update_profile') }}
        </button>
    </form>
</div>

<script>
    document.getElementById('country').addEventListener('change', function() {
        const country = this.value;
        const citySelect = document.getElementById('city');
        
        if (country) {
            // Fetch cities for the selected country
            fetch(`/get_cities/${country}`)
                .then(response => response.json())
                .then(cities => {
                    citySelect.innerHTML = '<option value="">{{ get_text("select_city") }}</option>';
                    cities.forEach(city => {
                        const option = document.createElement('option');
                        option.value = city;
                        option.textContent = city;
                        citySelect.appendChild(option);
                    });
                    citySelect.disabled = false;
                });
        } else {
            citySelect.innerHTML = '<option value="">{{ get_text("select_city") }}</option>';
            citySelect.disabled = true;
        }
    });
    
    // Add event listeners to update button styles when checkboxes are checked
    document.querySelectorAll('input[name="fetishes"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const label = document.querySelector(`label[for="${this.id}"]`);
            label.classList.toggle('selected', this.checked);
        });
    });
    
    document.querySelectorAll('input[name="interests"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const label = document.querySelector(`label[for="${this.id}"]`);
            label.classList.toggle('selected', this.checked);
        });
    });
</script>

<style>
    .fetish-btn, .interest-btn {
        display: block;
        padding: 10px 15px;
        margin: 5px;
        background-color: var(--card-bg);
        color: var(--text-color);
        border: 2px solid var(--border-color);
        border-radius: 20px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s ease;
        font-size: 0.9rem;
    }
    
    .fetish-btn:hover, .interest-btn:hover {
        background-color: var(--bg-color);
        border-color: var(--primary);
    }
    
    .fetish-btn.selected, .interest-btn.selected {
        background-color: var(--primary);
        color: white;
        border-color: var(--primary);
    }
    
    [data-theme="dark"] .fetish-btn.selected, [data-theme="dark"] .interest-btn.selected {
        background-color: var(--primary);
        color: white;
        border-color: var(--primary);
    }
    
    .fetish-item, .interest-item {
        display: block;
        margin: 0;
    }
    
    .fetish-item input[type="checkbox"], .interest-item input[type="checkbox"] {
        display: none;
    }
    
    [data-theme="dark"] .card-title {
        color: white !important;
    }
</style>

{% endblock %}