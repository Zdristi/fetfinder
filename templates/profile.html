{% extends "base.html" %}

{% block title %}{{ user_data.username or 'Profile' }} - {{ SITE_NAME }}{% endblock %}

{% block content %}
<div class="card">
    <div class="profile-header">
        {% if user_data.photo %}
            <img src="{{ url_for('optimized_image', filename=user_data.photo) if user_data.photo and not user_data.photo.startswith('http') else user_data.photo }}" 
                 alt="{{ user_data.username }}" class="profile-avatar" style="width: 100px; height: 100px; object-fit: cover;" loading="lazy">
        {% else %}
            <div class="profile-avatar">
                {{ user_data.username[0].upper() if user_data.username else '?' }}
            </div>
        {% endif %}
        <div class="profile-info">
            <h1>
                {{ user_data.username or 'Anonymous' }}
                {% if user_data.is_premium %}
                    <span class="premium-badge" style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.8rem; margin-left: 10px;">
                        <i class="fas fa-crown"></i> PREMIUM
                    </span>
                {% endif %}
                
                <!-- Gift badges -->
                {% set user_gift_badges = get_user_gift_badges(user_data.id) %}
                {% if user_gift_badges %}
                    {% for badge in user_gift_badges %}
                        <span class="gift-badge" title="{{ badge.description }}" style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; padding: 3px 6px; border-radius: 10px; font-size: 0.8rem; margin-left: 5px; display: inline-flex; align-items: center;">
                            {{ badge.icon }}
                        </span>
                    {% endfor %}
                {% endif %}
            </h1>
            {% if user_data.country or user_data.city %}
                <p>
                    <i class="fas fa-map-marker-alt"></i> 
                    {{ user_data.city }}{% if user_data.city and user_data.country %}, {% endif %}{{ user_data.country }}
                </p>
            {% endif %}
            <p><i class="fas fa-calendar-alt"></i> {{ get_text('member_since') }} {{ user_data.created_at[:10] }}</p>
            
            {# YOLO mode button #}
            {% if current_user.is_authenticated and current_user.id == user_data.id %}
                {% if has_yolo_mode(current_user) %}
                    <div style="margin-top: 10px;">
                        <button id="yoloModeBtn" class="btn" style="background: linear-gradient(135deg, #ff6b6b, #ffa500); padding: 10px 20px; border: none; border-radius: 25px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-dharmachakra"></i> YOLO MODE ACTIVE!
                        </button>
                    </div>
                {% else %}
                    <div style="margin-top: 10px;">
                        <button id="yoloModeBtn" class="btn" onclick="activateYoloMode()" style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 10px 20px; border: none; border-radius: 25px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-dharmachakra"></i> ACTIVATE YOLO MODE
                        </button>
                        <p style="font-size: 0.85rem; color: var(--gray); margin-top: 5px;">Unlock special features by receiving gifts or upgrading to premium</p>
                    </div>
                {% endif %}
            {% endif %}
            
            {# Debug current_user info #}
            {% if current_user %}
                <!-- current_user exists: {{ current_user.id }}, authenticated: {{ current_user.is_authenticated }}, user_data.id: {{ user_data.id }} -->
                {% if current_user.is_authenticated and current_user.id == user_data.id %}
                    <div style="margin-top: 15px;">
                        <a href="{{ url_for('edit_profile') }}" class="btn" style="padding: 10px 20px; text-decoration: none; display: inline-block;">
                            {{ get_text('edit_profile') }}
                        </a>
                    </div>
                {% endif %}
            {% else %}
                <!-- current_user does not exist -->
            {% endif %}
        </div>
    </div>
    
    {% if not is_complete %}
        <div style="background-color: #fff3cd; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #ffeaa7;">
            <p style="margin: 0; color: #856404;">
                <i class="fas fa-exclamation-circle"></i> {{ get_text('please_complete_profile') }}
            </p>
            <a href="{{ url_for('edit_profile') }}" class="btn" style="margin-top: 10px; padding: 8px 15px; font-size: 0.9rem;">
                {{ get_text('complete_profile') }}
            </a>
        </div>
    {% endif %}
    
    <div class="section-title">
        <h2 class="section-title-text"><i class="fas fa-user-circle"></i> {{ get_text('about') }}</h2>
    </div>
    <p>{{ user_data.bio or get_text('no_bio') }}</p>
    
    <div class="section-title">
        <h2 class="section-title-text"><i class="fas fa-fire"></i> {{ get_text('fetishes') }}</h2>
    </div>
    {% if user_data.fetishes %}
        <div>
            {% for fetish in user_data.fetishes %}
                <span class="badge badge-fetish">{{ fetish }}</span>
            {% endfor %}
        </div>
    {% else %}
        <p>{{ get_text('no_fetishes') }}</p>
    {% endif %}
    
    <div class="section-title">
        <h2 class="section-title-text"><i class="fas fa-heart"></i> {{ get_text('interests') }}</h2>
    </div>
    {% if user_data.interests %}
        <div>
            {% for interest in user_data.interests %}
                <span class="badge badge-interest">{{ interest }}</span>
            {% endfor %}
        </div>
    {% else %}
        <p>{{ get_text('no_interests') }}</p>
    {% endif %}
</div>

{% endblock %}

<script>
function activateYoloMode() {
    fetch('/api/activate_yolo_mode', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            // Update the button to show YOLO mode is active
            const yoloBtn = document.getElementById('yoloModeBtn');
            yoloBtn.innerHTML = '<i class="fas fa-dharmachakra"></i> YOLO MODE ACTIVE!';
            yoloBtn.style.background = 'linear-gradient(135deg, #ff6b6b, #ffa500)';
            yoloBtn.onclick = null; // Remove the click handler
            
            alert(data.message);
        } else {
            alert(data.message);
        }
    })
    .catch(error => {
        console.error('Error activating YOLO mode:', error);
        alert('Error activating YOLO mode. Please try again.');
    });
}
</script>