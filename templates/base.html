<!DOCTYPE html>
<html lang="{{ session.get('language', 'en') }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}LoveConnect Dating Site{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=1.1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5418763881443021"
         crossorigin="anonymous"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <a href="{{ url_for('home') }}">
                    <i class="fas fa-heart"></i>
                    FetFinder
                </a>
            </div>
            <div class="nav-links">
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('profile') }}">{{ get_text('profile') }}</a>
                    <a href="{{ url_for('swipe') }}">{{ get_text('discover') }}</a>
                    <a href="{{ url_for('chat_list') }}">{{ get_text('chat') }}</a>
                    <a href="{{ url_for('premium') }}">Premium</a>
                    {% if current_user.is_admin %}
                        <a href="{{ url_for('admin') }}">Admin Panel</a>
                    {% endif %}
                    <a href="{{ url_for('logout') }}">{{ get_text('logout') }} ({{ current_user.username }})</a>
                
                <!-- Notifications dropdown -->
                <div class="notification-dropdown" style="position: relative; display: inline-block;">
                    <button class="btn" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); padding: 8px 15px; font-size: 0.9rem;" onclick="toggleNotifications()">
                        <i class="fas fa-bell"></i>
                        <span id="notification-count" style="display: none; position: absolute; top: -5px; right: -5px; background: var(--primary); color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 0.7rem; display: flex; align-items: center; justify-content: center;"></span>
                    </button>
                    <div id="notificationDropdown" style="display: none; position: absolute; top: 100%; right: 0; background: var(--card-bg); border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); z-index: 1000; min-width: 300px; max-height: 500px; overflow-y: auto;">
                        <div style="padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="margin: 0;">{{ get_text('notifications') or 'Notifications' }}</h4>
                            <button type="button" class="btn btn-sm" style="padding: 5px 10px; font-size: 0.8rem;" onclick="markAllNotificationsAsRead()">{{ get_text('mark_all_read') or 'Mark all read' }}</button>
                        </div>
                        <div id="notifications-list" style="max-height: 400px; overflow-y: auto;">
                            <!-- Notifications will be loaded here -->
                        </div>
                    </div>
                </div>
</file>
</file>
                {% else %}
                    <a href="{{ url_for('login') }}">{{ get_text('login') }}</a>
                {% endif %}
                
                <!-- Theme Switcher -->
                <div class="theme-switcher" style="position: relative; display: inline-block;">
                    <button class="btn" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); padding: 8px 15px; font-size: 0.9rem;" onclick="toggleTheme()">
                        <i class="fas fa-moon theme-icon" id="themeIcon"></i>
                    </button>
                </div>
                
                <!-- Language Switcher -->
                <div class="language-switcher" style="position: relative; display: inline-block;">
                    <button class="btn" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); padding: 8px 15px; font-size: 0.9rem;" onclick="toggleLanguageMenu()">
                        <i class="fas fa-globe"></i> {{ get_text('language') }}
                    </button>
                    <div id="languageMenu" style="display: none; position: absolute; top: 100%; right: 0; background: var(--card-bg); border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); z-index: 1000; min-width: 150px;">
                        <a href="{{ url_for('set_language', lang='en') }}" style="display: block; padding: 10px 15px; color: var(--text-color); text-decoration: none; border-bottom: 1px solid var(--border-color);">{{ get_text('english') }}</a>
                        <a href="{{ url_for('set_language', lang='ru') }}" style="display: block; padding: 10px 15px; color: var(--text-color); text-decoration: none;">{{ get_text('russian') }}</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div style="background-color: #ffeb3b; padding: 15px; border-radius: 10px; margin: 20px 0; color: #333;">
                        <i class="fas fa-info-circle"></i> {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <!-- AdSense Ad Block -->
        <div class="ads-container" style="margin: 20px auto; text-align: center; max-width: 100%; background: var(--card-bg); padding: 10px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid var(--border-color);">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-5418763881443021"
                 data-ad-slot="YOUR_AD_SLOT_ID_HERE"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        {% block content %}{% endblock %}
    </div>
    
    <script>
        // Theme switching with animation
        function toggleTheme() {
            const htmlElement = document.documentElement;
            const themeIcon = document.getElementById('themeIcon');
            
            // Add transition class for smooth theme change
            htmlElement.classList.add('theme-transition');
            
            if (htmlElement.getAttribute('data-theme') === 'dark') {
                htmlElement.removeAttribute('data-theme');
                themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            } else {
                htmlElement.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            }
            
            // Remove transition class after animation completes
            setTimeout(() => {
                htmlElement.classList.remove('theme-transition');
            }, 300);
        }
        
        // Apply saved theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme');
            const themeIcon = document.getElementById('themeIcon');
            
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
        });
        
        function toggleLanguageMenu() {
            const menu = document.getElementById('languageMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }
        
        // Close menu when clicking outside
        window.onclick = function(event) {\n            const menu = document.getElementById('languageMenu');\n            const button = event.target.closest('.language-switcher');\n            if (menu && !button) {\n                menu.style.display = 'none';\n            }\n            \n            // Close notification dropdown when clicking outside\n            const notificationDropdown = document.getElementById('notificationDropdown');\n            const notificationButton = event.target.closest('.notification-dropdown');\n            if (notificationDropdown && !notificationButton) {\n                notificationDropdown.style.display = 'none';\n            }\n        }\n        \n        // Notification functions\n        function toggleNotifications() {\n            const dropdown = document.getElementById('notificationDropdown');\n            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';\n            \n            if(dropdown.style.display === 'block') {\n                loadNotifications();\n            }\n        }\n        \n        function loadNotifications() {\n            fetch('/api/notifications')\n                .then(response => response.json())\n                .then(data => {\n                    const notificationsList = document.getElementById('notifications-list');\n                    const notificationCount = document.getElementById('notification-count');\n                    \n                    // Clear current notifications\n                    notificationsList.innerHTML = '';\n                    \n                    if(data.length > 0) {\n                        // Show notification count\n                        notificationCount.textContent = data.length;\n                        notificationCount.style.display = 'flex';\n                        \n                        // Add each notification to the list\n                        data.forEach(notification => {\n                            const notificationDiv = document.createElement('div');\n                            notificationDiv.className = 'notification-item';\n                            notificationDiv.style.padding = '10px 15px';\n                            notificationDiv.style.borderBottom = '1px solid var(--border-color)';\n                            notificationDiv.style.cursor = 'pointer';\n                            notificationDiv.style.background = notification.is_read ? 'transparent' : 'var(--bg-color)';\n                            \n                            notificationDiv.innerHTML = `\n                                <div style=\"display: flex; justify-content: space-between; align-items: flex-start;\">\n                                    <div style=\"flex: 1;\">\n                                        <div style=\"font-weight: bold; margin-bottom: 5px;\">${notification.title}</div>\n                                        <div style=\"font-size: 0.9rem; color: var(--gray); margin-bottom: 5px;\">${notification.content}</div>\n                                        <div style=\"font-size: 0.8rem; color: var(--gray);\">${new Date(notification.timestamp).toLocaleString()}</div>\n                                    </div>\n                                </div>\n                            `;\n                            \n                            if (!notification.is_read) {\n                                notificationDiv.style.fontWeight = 'bold';\n                            }\n                            \n                            notificationDiv.onclick = function() {\n                                markNotificationAsRead(notification.id);\n                                if (notification.url) {\n                                    window.location.href = notification.url;\n                                }\n                                notificationDiv.style.background = 'transparent';\n                                notificationDiv.style.fontWeight = 'normal';\n                            };\n                            \n                            notificationsList.appendChild(notificationDiv);\n                        });\n                    } else {\n                        // No notifications message\n                        notificationCount.style.display = 'none';\n                        notificationsList.innerHTML = '<div style=\"padding: 15px; text-align: center; color: var(--gray);\">{{ get_text(\\'no_notifications\\') or \\'No notifications yet\\' }}</div>';\n                    }\n                })\n                .catch(error => console.error('Error loading notifications:', error));\n        }\n        \n        function markNotificationAsRead(notificationId) {\n            fetch(`/api/notifications/${notificationId}/read`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                }\n            })\n            .then(response => response.json())\n            .then(data => {\n                if(data.status === 'success') {\n                    // Reload notifications to update the count\n                    setTimeout(loadNotifications, 500);\n                }\n            })\n            .catch(error => console.error('Error marking notification as read:', error));\n        }\n        \n        function markAllNotificationsAsRead() {\n            fetch('/api/notifications/read-all', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                }\n            })\n            .then(response => response.json())\n            .then(data => {\n                if(data.status === 'success') {\n                    document.getElementById('notification-count').style.display = 'none';\n                    loadNotifications();\n                }\n            })\n            .catch(error => console.error('Error marking all notifications as read:', error));\n        }\n        \n        // Check for new notifications every 30 seconds\n        setInterval(function() {\n            if(document.visibilityState === 'visible') {\n                loadNotifications();\n            }\n        }, 30000);\n    </script>
    
    <style>
        [data-theme="dark"] .welcome-back {
            color: white !important;
        }
        
        [data-theme="dark"] .section-title-text {
            color: white !important;
        }
    </style>
</body>
</html>