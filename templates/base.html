<!DOCTYPE html>
<html lang="{{ session.get('language', 'en') }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}LoveConnect Dating Site{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=1.1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5418763881443021"
         crossorigin="anonymous"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <a href="{{ url_for('home') }}">
                    <i class="fas fa-heart"></i>
                    FetDate
                </a>
            </div>
            <div class="nav-links">
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('profile') }}">{{ get_text('profile') }}</a>
                    <a href="{{ url_for('swipe') }}">{{ get_text('discover') }}</a>
                    <a href="{{ url_for('chat_list') }}">{{ get_text('chat') }}</a>
                    <a href="{{ url_for('premium') }}">Premium</a>
                    {% if current_user.is_admin %}
                        <a href="{{ url_for('admin') }}">Admin Panel</a>
                    {% endif %}
                    <a href="{{ url_for('logout') }}">{{ get_text('logout') }} ({{ current_user.username }})</a>
                
                <!-- Notifications dropdown -->
                <div class="notification-dropdown" style="position: relative; display: inline-block;">
                    <button class="btn" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); padding: 8px 15px; font-size: 0.9rem;" onclick="toggleNotifications()">
                        <i class="fas fa-bell"></i>
                        <span id="notification-count" style="display: none; position: absolute; top: -5px; right: -5px; background: var(--primary); color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 0.7rem; display: flex; align-items: center; justify-content: center;"></span>
                    </button>
                    <div id="notificationDropdown" style="display: none; position: absolute; top: 100%; right: 0; background: var(--card-bg); border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); z-index: 1000; min-width: 300px; max-height: 500px; overflow-y: auto;">
                        <div style="padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="margin: 0;">{{ get_text('notifications') or 'Notifications' }}</h4>
                            <button id="mark-all-read-btn" type="button" class="btn btn-sm" style="padding: 5px 10px; font-size: 0.8rem; display: none;" onclick="markAllNotificationsAsRead()">{{ get_text('mark_all_read') or 'Mark all read' }}</button>
                        </div>
                        <div id="notifications-list" style="max-height: 400px; overflow-y: auto;">
                            <!-- Notifications will be loaded here -->
                        </div>
                    </div>
                </div>
</file>
</file>
                {% else %}
                    <a href="{{ url_for('login') }}">{{ get_text('login') }}</a>
                {% endif %}
                
                <!-- Theme Switcher -->
                <div class="theme-switcher" style="position: relative; display: inline-block;">
                    <button class="btn" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); padding: 8px 15px; font-size: 0.9rem;" onclick="toggleTheme()">
                        <i class="fas fa-moon theme-icon" id="themeIcon"></i>
                    </button>
                </div>
                
                <!-- Language Switcher -->
                <div class="language-switcher" style="position: relative; display: inline-block;">
                    <button class="btn" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); padding: 8px 15px; font-size: 0.9rem;" onclick="toggleLanguageMenu()">
                        <i class="fas fa-globe"></i> {{ get_text('language') }}
                    </button>
                    <div id="languageMenu" style="display: none; position: absolute; top: 100%; right: 0; background: var(--card-bg); border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); z-index: 1000; min-width: 150px;">
                        <a href="{{ url_for('set_language', lang='en') }}" style="display: block; padding: 10px 15px; color: var(--text-color); text-decoration: none; border-bottom: 1px solid var(--border-color);">{{ get_text('english') }}</a>
                        <a href="{{ url_for('set_language', lang='ru') }}" style="display: block; padding: 10px 15px; color: var(--text-color); text-decoration: none;">{{ get_text('russian') }}</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div style="background-color: #ffeb3b; padding: 15px; border-radius: 10px; margin: 20px 0; color: #333;">
                        <i class="fas fa-info-circle"></i> {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        {% block content %}{% endblock %}
    </div>
    
    <script>
        // Theme switching with animation
        function toggleTheme() {
            const htmlElement = document.documentElement;
            const themeIcon = document.getElementById('themeIcon');
            
            // Add transition class for smooth theme change
            htmlElement.classList.add('theme-transition');
            
            if (htmlElement.getAttribute('data-theme') === 'dark') {
                htmlElement.removeAttribute('data-theme');
                themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            } else {
                htmlElement.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            }
            
            // Remove transition class after animation completes
            setTimeout(() => {
                htmlElement.classList.remove('theme-transition');
            }, 300);
        }
        
        // Apply saved theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme');
            const themeIcon = document.getElementById('themeIcon');
            
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
        });
        
        function toggleLanguageMenu() {
            const menu = document.getElementById('languageMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }
        
        // Close menu when clicking outside
        window.onclick = function(event) {
            const menu = document.getElementById('languageMenu');
            const button = event.target.closest('.language-switcher');
            if (menu && !button) {
                menu.style.display = 'none';
            }
            
            // Close notification dropdown when clicking outside
            const notificationDropdown = document.getElementById('notificationDropdown');
            const notificationButton = event.target.closest('.notification-dropdown');
            if (notificationDropdown && !notificationButton) {
                notificationDropdown.style.display = 'none';
            }
        }
        
        // Notification functions
        function toggleNotifications() {
            const dropdown = document.getElementById('notificationDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            
            if(dropdown.style.display === 'block') {
                loadNotifications();
            }
        }
        
        function loadNotifications() {
            fetch('/api/notifications')
                .then(response => response.json())
                .then(data => {
                    const notificationsList = document.getElementById('notifications-list');
                    const notificationCount = document.getElementById('notification-count');
                    
                    // Clear current notifications
                    notificationsList.innerHTML = '';
                    
                    if(data.length > 0) {
                        // Show notification count (show 9+ if more than 9)
                        const displayCount = data.length > 9 ? '9+' : data.length;
                        notificationCount.textContent = displayCount;
                        notificationCount.style.display = 'flex';
                        
                        // Show the "Mark all read" button
                        document.getElementById('mark-all-read-btn').style.display = 'block';
                        
                        // Add each notification to the list
                        data.forEach(notification => {
                            const notificationDiv = document.createElement('div');
                            notificationDiv.className = 'notification-item';
                            notificationDiv.style.padding = '10px 15px';
                            notificationDiv.style.borderBottom = '1px solid var(--border-color)';
                            notificationDiv.style.cursor = 'pointer';
                            notificationDiv.style.background = notification.is_read ? 'transparent' : 'var(--bg-color)';
                            
                            notificationDiv.innerHTML = `
                                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: bold; margin-bottom: 5px;">${notification.title}</div>
                                        <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 5px;">${notification.content}</div>
                                        <div style="font-size: 0.8rem; color: var(--gray);">${new Date(notification.timestamp).toLocaleString()}</div>
                                    </div>
                                    ${!notification.is_read ? '<div style="width: 8px; height: 8px; background: var(--primary); border-radius: 50%; margin-left: 10px;"></div>' : ''}
                                </div>
                            `;
                            
                            if (!notification.is_read) {
                                notificationDiv.style.fontWeight = 'bold';
                            }
                            
                            notificationDiv.onclick = function() {
                                markNotificationAsRead(notification.id);
                                if (notification.url) {
                                    window.location.href = notification.url;
                                }
                                notificationDiv.style.background = 'transparent';
                                notificationDiv.style.fontWeight = 'normal';
                            };
                            
                            notificationsList.appendChild(notificationDiv);
                        });
                    } else {
                        // No notifications message
                        notificationCount.style.display = 'none';
                        document.getElementById('mark-all-read-btn').style.display = 'none';
                        notificationsList.innerHTML = '<div style="padding: 15px; text-align: center; color: var(--gray);">{{ get_text('no_notifications') or 'No notifications yet' }}</div>';
                    }
                })
                .catch(error => console.error('Error loading notifications:', error));
        }
        
        function markNotificationAsRead(notificationId) {
            fetch(`/api/notifications/${notificationId}/read`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if(data.status === 'success') {
                    // Reload notifications to update the count
                    setTimeout(loadNotifications, 500);
                }
            })
            .catch(error => console.error('Error marking notification as read:', error));
        }
        
        function markAllNotificationsAsRead() {
            fetch('/api/notifications/read-all', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if(data.status === 'success') {
                    loadNotifications();
                }
            })
            .catch(error => console.error('Error marking all notifications as read:', error));
        }
        
        // Check for new notifications every 30 seconds
        setInterval(function() {
            if(document.visibilityState === 'visible') {
                loadNotifications();
            }
        }, 30000);
    </script>
    
    <style>
        [data-theme="dark"] .welcome-back {
            color: white !important;
        }
        
        [data-theme="dark"] .section-title-text {
            color: white !important;
        }
        
        /* Styling for fetish and interest buttons */
        .fetish-btn, .interest-btn {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            background-color: var(--card-bg);
            color: var(--text-color);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .fetish-btn:hover, .interest-btn:hover {
            background-color: var(--bg-color);
            border-color: var(--primary);
        }
        
        .fetish-btn.selected, .interest-btn.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        [data-theme="dark"] .fetish-btn.selected, [data-theme="dark"] .interest-btn.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .fetish-item, .interest-item {
            display: inline-block;
            margin: 0;
        }
        
        .fetish-item input[type="checkbox"], .interest-item input[type="checkbox"] {
            display: none;
        }
    </style>
    

</body>
</html>